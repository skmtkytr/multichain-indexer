#!/usr/bin/env ruby
require_relative "../config/environment"
require "temporalio/worker"

Rails.logger.info "Starting Temporal worker..."

client = TemporalClient.connection

worker = Temporalio::Worker.new(
  client: client,
  task_queue: ENV.fetch("TEMPORAL_TASK_QUEUE", "evm-indexer"),
  workflows: [
    Indexer::BlockPollerWorkflow,
    Indexer::BlockProcessorWorkflow
  ],
  activities: [
    Indexer::FetchBlockActivity,
    Indexer::ProcessBlockActivity,
    Indexer::ProcessTransactionActivity,
    Indexer::ProcessLogActivity
  ]
)

worker.run(shutdown_signals: %w[SIGINT SIGTERM])
